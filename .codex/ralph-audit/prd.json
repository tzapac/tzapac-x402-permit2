{
  "project": "x402_permit2 Read-Only Audit (Etherlink / Coinbase-aligned)",
  "branchName": "codex/coinbase-align",
  "description": "Pure read-only audit loop. NO FIXES. Document broken logic, security issues, unfinished features, drift, dead ends, and things that will break. Write findings to .codex/ralph-audit/audit/*.md files.",
  "verificationCommands": {
    "typecheck": "echo 'Audit mode - no verification needed'",
    "lint": "echo 'Audit mode - no verification needed'",
    "test": "echo 'Audit mode - no verification needed'"
  },
  "userStories": [
    {
      "id": "AUDIT-001",
      "title": "Protocol + Header/Wire Format Deep Audit",
      "description": "Exhaustively audit the PoC server/client and wallet UI for x402 v2 header correctness and security invariants.",
      "acceptanceCriteria": [
        "Created .codex/ralph-audit/audit/01-protocol-wire.md with ALL findings",
        "All files examined line-by-line for security invariants (spender/payTo/amount binding), header correctness (v2 + legacy), validation and error handling",
        "Each finding includes: file path, line numbers, severity, description, and a code snippet"
      ],
      "priority": 1,
      "passes": false,
      "notes": "DO NOT FIX ANYTHING. Read EVERY LINE of: README.md, bbt_mvp_server.py, bbt_mvp_client.py, wallet_connect_poc.html, logging_utils.py, nginx.wallet-poc.conf. Focus on: Payment-Required / Payment-Signature handling, base64 encoding/decoding, accepted requirements matching, assetTransferMethod signaling, spender selection, witness binding semantics, CORS/mixed content risks, user-input validation (URLs, addresses), chain-id/domain separation correctness, unsafe defaults, and anything that can cause incorrect payment settlement."
    },
    {
      "id": "AUDIT-002",
      "title": "Solidity Proxy + Verification Artifact Deep Audit",
      "description": "Exhaustively audit the included proxy Solidity and verification inputs for correctness and equivalence claims.",
      "acceptanceCriteria": [
        "Created .codex/ralph-audit/audit/02-solidity-proxy.md with ALL findings",
        "All Solidity + verification artifacts examined line-by-line for security invariants and drift from claimed upstream",
        "Each finding includes: file path, line numbers, severity, description, and a code snippet"
      ],
      "priority": 2,
      "passes": false,
      "notes": "DO NOT FIX ANYTHING. Read EVERY LINE of: contracts/x402ExactPermit2Proxy_etherlink_flat.sol, contracts/x402ExactPermit2Proxy_etherlink_standard_input.json, and everything under contracts/coinbase_x402_proxy/**. Verify: witness enforcement (to/validAfter/extra), reentrancy/nonce/deadline handling, EIP-2612 optional permit behavior, events, and any mismatch between flattened vs standard JSON input vs claimed deployed bytecode."
    },
    {
      "id": "AUDIT-003",
      "title": "Rust Facilitator (Permit2 Settlement) Deep Audit",
      "description": "Exhaustively audit the Rust facilitator implementation for Permit2 settlement invariants and dangerous defaults.",
      "acceptanceCriteria": [
        "Created .codex/ralph-audit/audit/03-rust-facilitator.md with ALL findings",
        "All facilitator files examined line-by-line for signature verification, spender enforcement, payTo invariants, nonce/deadline handling, and unsafe config",
        "Each finding includes: file path, line numbers, severity, description, and a code snippet"
      ],
      "priority": 3,
      "passes": false,
      "notes": "DO NOT FIX ANYTHING. Read EVERY LINE under: bbt-x402-facilitator/facilitator/src/** and bbt-x402-facilitator/crates/chains/x402-chain-eip155/src/** plus bbt-x402-facilitator/crates/x402-axum/src/** and bbt-x402-facilitator/crates/x402-types/src/**. Focus on: spender enforcement, witness.to/payTo binding, accepted requirements matching, replay protection, on-chain simulation assumptions, nonce management, RPC error handling, and any path where the facilitator could settle to the wrong recipient or amount."
    },
    {
      "id": "AUDIT-004",
      "title": "Docker/Compose/Nginx Stack Deep Audit",
      "description": "Exhaustively audit the deployment stack files for drift, wrong ports, and origin routing hazards (502s, misroutes).",
      "acceptanceCriteria": [
        "Created .codex/ralph-audit/audit/04-stack.md with ALL findings",
        "All stack/config files examined line-by-line for correctness and operational footguns",
        "Each finding includes: file path, line numbers, severity, description, and a code snippet"
      ],
      "priority": 4,
      "passes": false,
      "notes": "DO NOT FIX ANYTHING. Read EVERY LINE of: docker-compose.model3-etherlink.yml, docker-compose.wallet-poc.yml, Dockerfile.store-api, Dockerfile.store-web, build_mvp_images.sh, nginx.wallet-poc.conf. Focus on: port bindings, dependency order, env var propagation, hard-coded URLs/addresses, container networking assumptions, and any mismatch with documented run commands."
    },
    {
      "id": "AUDIT-005",
      "title": "Playbook Safety Deep Audit",
      "description": "Exhaustively audit the playbook for safety hazards (funding, allowances, role swaps) and correctness drift.",
      "acceptanceCriteria": [
        "Created .codex/ralph-audit/audit/05-playbook.md with ALL findings",
        "Playbook examined line-by-line for unsafe behavior and broken assumptions",
        "Each finding includes: file path, line numbers, severity, description, and a code snippet"
      ],
      "priority": 5,
      "passes": false,
      "notes": "DO NOT FIX ANYTHING. Read EVERY LINE of: playbook_permit2_flow.py plus any imported local files it uses. Focus on: accidental mainnet spending, funding/topup logic, key handling, allowance checks, incorrect chain selection, replayable payloads, and logging of sensitive data."
    },
    {
      "id": "AUDIT-006",
      "title": "Docs Accuracy Deep Audit",
      "description": "Exhaustively audit README + docs for correctness vs implementation.",
      "acceptanceCriteria": [
        "Created .codex/ralph-audit/audit/06-docs.md with ALL findings",
        "Docs examined line-by-line for inaccuracies, missing caveats, and drift",
        "Each finding includes: file path, line numbers, severity, description, and a code snippet"
      ],
      "priority": 6,
      "passes": false,
      "notes": "DO NOT FIX ANYTHING. Read EVERY LINE of: README.md, docs/coinbase_comparison.md, docs/feature_matrix.md, and bbt-x402-facilitator/README.md. Focus on: claims about parity with Coinbase, proxy verification/deployment addresses, supported standards (Permit2/EIP-3009/EIP-2612), and operational requirements."
    },
    {
      "id": "AUDIT-007",
      "title": "Secrets/Env Handling Deep Audit",
      "description": "Exhaustively audit env/config usage and logging for accidental leakage risk.",
      "acceptanceCriteria": [
        "Created .codex/ralph-audit/audit/07-secrets-env.md with ALL findings",
        "Env + logging examined line-by-line for leakage and unsafe defaults",
        "Each finding includes: file path, line numbers, severity, description, and a code snippet"
      ],
      "priority": 7,
      "passes": false,
      "notes": "DO NOT FIX ANYTHING. Read EVERY LINE of: .env.example, bbt_mvp_server.py, bbt_mvp_client.py, playbook_permit2_flow.py, and any file that reads env vars. Focus on: printing sensitive values, defaulting to unsafe endpoints, unclear env var docs, and any file that may accidentally commit secrets."
    },
    {
      "id": "AUDIT-008",
      "title": "Dead Code / Drifted Scripts Deep Audit",
      "description": "Find dead code, unused files, drifted scripts, and mismatched examples.",
      "acceptanceCriteria": [
        "Created .codex/ralph-audit/audit/08-dead-code.md with ALL findings",
        "Repo scanned for unused or misleading files and scripts",
        "Each finding includes: file path, line numbers, severity, description, and a code snippet"
      ],
      "priority": 8,
      "passes": false,
      "notes": "DO NOT FIX ANYTHING. Read EVERY LINE of: bbt_client.py, bbt_storefront.py, manual_payment_test.py, manual_storefront.py, mvp_client.py, mvp_server.py, sdk_payment_proof.py, and any other scripts not referenced by README. Focus on: stale header names, wrong assumptions about gas payer roles, unused flows, and confusing drift relative to the Coinbase-aligned path."
    }
  ]
}


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ETHERLINK x402 // PERMIT2 UPLINK</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Rajdhani:wght@500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/wallet_connect_poc.css?v=20260211-2">
</head>
<body>

<div id="disclaimer-overlay" class="modal-overlay">
    <div class="modal-card">
        <div class="modal-title">Experimental Notice</div>
        <div class="modal-body">
            This project is experimental and has not been audited. Use at your own risk.
        </div>
        <div class="modal-actions">
            <button id="disclaimer-ok-btn">I UNDERSTAND</button>
        </div>
    </div>
</div>

<div class="container">
    <header>
        <h1>x402 <span class="beta-badge">BETA</span></h1>
        <div class="status-indicator">
            <div id="status-dot" class="status-dot"></div>
            <span id="status-text">OFFLINE</span>
        </div>
    </header>

    <div class="tab-bar">
        <button class="tab-button" data-tab="server">Server</button>
        <button class="tab-button" data-tab="facilitator">Facilitator</button>
        <button class="tab-button active" data-tab="demo">Demo</button>
    </div>

    <div class="tab-panel" data-panel="demo">
        <div class="content">
        <!-- Wallet Section -->
        <div id="wallet-section">
            <div class="data-row">
                <span class="data-label">Network</span>
                <span id="network-display" class="data-value">--</span>
            </div>
            <div class="data-row">
                <span class="data-label">Account</span>
                <span id="account-display" class="data-value address">--</span>
            </div>
        </div>

        <!-- Facilitator Section -->
        <div id="facilitator-section">
            <div class="data-row">
                <span class="data-label">Facilitator URL</span>
                <span class="data-value address">
                    <input id="facilitator-input" class="text-input" type="text" value="" />
                </span>
            </div>
            <div class="data-row">
                <span class="data-label">Facilitator Spender</span>
                <span class="data-value address">
                    <input id="spender-input" class="text-input" type="text" placeholder="0x... (x402 proxy address)" />
                </span>
            </div>
        </div>

        <!-- Store Section -->
        <div id="store-section">
            <div class="data-row">
                <span class="data-label">Store API URL</span>
                <span class="data-value address">
                    <input id="store-input" class="text-input" type="text" value="" />
                </span>
            </div>
            <div id="catalog-row" class="data-row hidden">
                <span class="data-label">Catalog Item</span>
                <span class="data-value address">
                    <select id="catalog-select" class="text-input"></select>
                </span>
            </div>
            <div class="data-row">
                <span class="data-label">Payment Amount</span>
                <span id="amount-display" class="data-value">--</span>
            </div>
            <div class="data-row">
                <span class="data-label">Pay To</span>
                <span id="payto-display" class="data-value address">--</span>
            </div>
        </div>

        <div class="data-row">
            <span class="data-label">Gas Payer</span>
            <span class="data-value">
                <div class="toggle-group">
                    <button id="gas-facilitator-btn" class="toggle-button active">FACILITATOR PAYS GAS (TZAPAC)</button>
                </div>
            </span>
        </div>

        <!-- Flow Actions -->
        <div class="actions flow-actions">
            <button id="health-btn">1. CHECK /HEALTH</button>
            <button id="requirements-btn">2. GET PAYMENT</button>
            <button id="approve-btn" class="hidden">3. APPROVE PERMIT2</button>
            <button id="pay-btn" disabled>4. SIGN & PAY</button>
        </div>

        <!-- Console -->
        <div id="console-output">
            <div class="log-entry log-info">> SYSTEM READY</div>
            <div class="log-entry log-info">> WAITING FOR CONNECTION...</div>
        </div>

        <div class="actions">
            <button id="token-toggle-btn">SHOW TOKEN DETAILS</button>
        </div>

        <!-- Token Section -->
        <div id="token-section" class="hidden">
            <div class="data-row">
                <span class="data-label">Asset</span>
                <span class="data-value">BBT (BubbleTez)</span>
            </div>
            <div class="data-row">
                <span class="data-label">Balance</span>
                <span id="balance-display" class="data-value">0.00</span>
            </div>
            <div class="data-row">
                <span class="data-label">ERC20 Allowance -> Permit2</span>
                <span id="allowance-display" class="data-value">0.00</span>
            </div>
            <div id="permit2-allowance-row" class="data-row hidden">
                <span class="data-label">Permit2 Allowance</span>
                <span id="permit2-allowance-display" class="data-value">--</span>
            </div>
            <div class="data-row">
                <span class="data-label">Permit2 Expiration</span>
                <span id="permit2-expiration-display" class="data-value">--</span>
            </div>
            <div class="data-row">
                <span class="data-label">Permit2 Nonce</span>
                <span id="permit2-nonce-display" class="data-value">--</span>
            </div>
        </div>
        </div>
    </div>

    <div class="tab-panel hidden" data-panel="server">
        <div class="content">
            <div class="guide-block">
                <div class="guide-title">Documentation URLs</div>
                <ul class="guide-list">
                    <li><a class="guide-link" href="https://github.com/tzapac/tzapac-x402-permit2/blob/main/docs/store_operator_guide.md" target="_blank" rel="noopener noreferrer">Store Operator Guide</a></li>
                    <li><a class="guide-link" href="https://github.com/tzapac/tzapac-x402-permit2/blob/main/docs/server_guide.md" target="_blank" rel="noopener noreferrer">Server Integration Guide</a></li>
                    <li><a class="guide-link" href="https://github.com/tzapac/tzapac-x402-permit2/blob/main/docs/client_guide.md" target="_blank" rel="noopener noreferrer">Client Integration Guide</a></li>
                    <li><a class="guide-link" href="https://github.com/tzapac/tzapac-x402-permit2/blob/main/docs/facilitator_api_glossary.md" target="_blank" rel="noopener noreferrer">Facilitator API Glossary</a></li>
                    <li><a class="guide-link" href="https://github.com/tzapac/tzapac-x402-permit2/blob/main/docs/facilitator_hosting_guide.md" target="_blank" rel="noopener noreferrer">Facilitator Hosting Guide</a></li>
                </ul>
            </div>
            <div class="guide-block">
                <div class="guide-title">Store / Server Setup</div>
                <div class="guide-text">
                    Run the local stack with docker-compose (store API + store web/proxy + facilitator).
                </div>
                <ul class="guide-list">
                    <li>Create `.env` with store wallet/private key and RPC details.</li>
                    <li>Start stack using `docker-compose.wallet-poc.yml`.</li>
                    <li>Open UI at `http://localhost:9091`.</li>
                </ul>
                <pre># .env (local stack)
FACILITATOR_URL=http://localhost:9090
RPC_URL=https://YOUR_ETHERLINK_RPC
CHAIN_ID=42793
SERVER_WALLET=0xYOUR_STORE_WALLET
STORE_PRIVATE_KEY=0xYOUR_STORE_PRIVATE_KEY
BBT_TOKEN=0x7EfE4bdd11237610bcFca478937658bE39F8dfd6
PERMIT2_ADDRESS=0x000000000022D473030F116dDEE9F6B43aC78BA3
X402_EXACT_PERMIT2_PROXY_ADDRESS=0xB6FD384A0626BfeF85f3dBaf5223Dd964684B09E
PUBLIC_BASE_URL=
</pre>
                <pre>docker compose -f docker-compose.wallet-poc.yml up -d --build</pre>
                <div class="guide-text">
                    Set `PUBLIC_BASE_URL` only if you want a fixed public URL in `Payment-Required.resource.url`.
                </div>
            </div>
        </div>
    </div>

    <div class="tab-panel hidden" data-panel="facilitator">
        <div class="content">
            <div class="guide-block">
                <div class="guide-title">Documentation URLs</div>
                <ul class="guide-list">
                    <li><a class="guide-link" href="https://github.com/tzapac/tzapac-x402-permit2/blob/main/docs/facilitator_hosting_guide.md" target="_blank" rel="noopener noreferrer">Facilitator Hosting Guide</a></li>
                    <li><a class="guide-link" href="https://github.com/tzapac/tzapac-x402-permit2/blob/main/docs/facilitator_api_glossary.md" target="_blank" rel="noopener noreferrer">Facilitator API Glossary</a></li>
                    <li><a class="guide-link" href="https://github.com/tzapac/tzapac-x402-permit2/blob/main/docs/store_operator_guide.md" target="_blank" rel="noopener noreferrer">Store Operator Guide</a></li>
                </ul>
            </div>
            <div class="guide-block">
                <div class="guide-title">Facilitator Setup</div>
                <div class="guide-text">
                    Facilitator gas mode is the only supported execution path in this Coinbase-aligned branch.
                </div>
                <ul class="guide-list">
                    <li>The easiest path is running via `docker-compose.wallet-poc.yml`.</li>
                    <li>For standalone runs, provide a signer private key and RPC endpoint.</li>
                </ul>
                <pre># .env (facilitator standalone)
FACILITATOR_PRIVATE_KEY=0xYOUR_FACILITATOR_PRIVATE_KEY
X402_EXACT_PERMIT2_PROXY_ADDRESS=0xB6FD384A0626BfeF85f3dBaf5223Dd964684B09E
X402_EXACT_PERMIT2_PROXY_CODEHASH_ALLOWLIST=0x73020ff18bfd4eaba45de17760ad433063ed6267a8371ef54a39083a14180366
</pre>
                <pre>// bbt_config.json
{
  "port": 9090,
  "host": "0.0.0.0",
  "chains": {
    "eip155:42793": {
      "eip1559": true,
      "signers": ["$FACILITATOR_PRIVATE_KEY"],
      "rpc": [
        { "http": "https://YOUR_ETHERLINK_RPC", "rate_limit": 100 }
      ]
    }
  },
  "schemes": [
    { "id": "v2-eip155-exact", "chains": "eip155:42793", "enabled": true }
  ]
}
</pre>
                <pre># Option A: pinned image digest (recommended)
docker run --env-file .env -p 9090:9090 \
  -v $(pwd)/bbt_config.json:/app/bbt_config.json \
  ghcr.io/tzapac/tzapac-x402-permit2-facilitator@sha256:REPLACE_WITH_PUBLISHED_DIGEST \
  --config /app/bbt_config.json

# Option B: build locally from source
docker build -t bbt-x402-facilitator:local -f bbt-x402-facilitator/Dockerfile.bbt bbt-x402-facilitator
docker run --env-file .env -p 9090:9090 \
  -v $(pwd)/bbt_config.json:/app/bbt_config.json \
  bbt-x402-facilitator:local --config /app/bbt_config.json
</pre>
                <div class="guide-text">
                    Local compose already wires the same facilitator flow.
                </div>
            </div>
        </div>
    </div>
    </div>

    <footer>
        built with <3 by tzapac.
    </footer>
</div>

<script src="/wallet_connect_poc.js?v=20260211-2"></script>

</body>
</html>
